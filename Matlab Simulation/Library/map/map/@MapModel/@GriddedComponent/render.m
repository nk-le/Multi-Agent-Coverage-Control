function h = render(this,layerName,legend,ax,visibility) %#ok<INUSL>
%RENDER Render the GriddedComponent.
% 
%   H = RENDER(LAYERNAME,LEGEND,AX,VISIBILITY) constructs a surface in
%   the axes AX, with the specified VISIBILITY. Input LEGEND is ignored
%   for this type of component.

%   Copyright 1996-2020 The MathWorks, Inc.

R = this.ReferenceMatrix;

if (~isempty(R))
    R = refmatToMapRasterReference(R, size(this.GriddedData));
    [this.Xdata, this.Ydata] = worldGrid(R,"gridvectors");
end

prevClim = get(ax,'CLim');
if strcmpi(this.DisplayType,'mesh')
    fc = get(ax,'Color');
    h = surface( ...
        'Parent',ax,...
        'Xdata',this.Xdata,...
        'Ydata',this.Ydata,...
        'Zdata',zeros(size(this.GriddedData)),...
        'Cdata',this.GriddedData,...
        'CDataMapping','scaled',...
        'FaceColor',fc...
        );
else
    h = surface(...
        'Parent',ax,...
        'Xdata',this.Xdata,...
        'Ydata',this.Ydata,...
        'Zdata',zeros(size(this.GriddedData)),...
        'Cdata',this.GriddedData,...
        'CDataMapping','scaled',...
        'EdgeColor','none',...
        'FaceColor','flat'...
        );
end

fig = ancestor(ax,'Figure');
ch = findall(ax,'Type','surface');
cmap = this.ColorMap;
clim = [min(this.GriddedData(:)) max(this.GriddedData(:))];

if length(ch) > 1
  clim = [min([prevClim, clim]) max([prevClim, clim])];
  cmap = demcmap(clim);
end

set(fig,'Colormap',cmap);
set(ax,'CLim',clim);  
set(h,'Visible',visibility,'Tag',layerName)
